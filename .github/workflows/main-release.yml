# Mainåˆ†æ”¯è‡ªåŠ¨æ‰“åŒ…å‘å¸ƒæµç¨‹
# å½“å‘mainåˆ†æ”¯æäº¤PRæ—¶è§¦å‘å¤šå¹³å°å¤šæž¶æž„çš„è‡ªåŠ¨æ‰“åŒ…å’Œå‘å¸ƒ
name: è‡ªåŠ¨æ‰“åŒ…å‘å¸ƒ

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
    types: [opened, synchronize, reopened]
  workflow_dispatch:
    inputs:
      version:
        description: 'å‘å¸ƒç‰ˆæœ¬å· (ä¾‹å¦‚: v1.0.0)'
        required: true
        default: 'v1.0.0'
      include_arm64:
        description: 'æ˜¯å¦åŒ…å«ARM64æž¶æž„ (å®žéªŒæ€§åŠŸèƒ½)'
        required: false
        default: false
        type: boolean

# è®¾ç½®GitHub Actionsæƒé™
permissions:
  contents: write  # å…è®¸åˆ›å»ºreleaseå’Œä¸Šä¼ æ–‡ä»¶
  pages: write     # å…è®¸éƒ¨ç½²åˆ°GitHub Pages
  id-token: write  # å…è®¸OIDC tokenå†™å…¥

jobs:
  # å‘å¸ƒå‰æ£€æŸ¥
  pre-release-check:
    name: å‘å¸ƒå‰æ£€æŸ¥
    runs-on: ubuntu-22.04  # æ˜Žç¡®æŒ‡å®šUbuntu 22.04ä»¥é¿å…Ubuntu 24.04å…¼å®¹æ€§é—®é¢˜

    steps:
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v4

    - name: è®¾ç½®PythonçŽ¯å¢ƒ
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'

    - name: å®‰è£…ä¾èµ–
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: è¿è¡Œå®Œæ•´æµ‹è¯•
      run: |
        echo "ðŸ§ª è¿è¡Œå‘å¸ƒå‰æµ‹è¯•..."
        python scripts/run_tests.py
        pytest tests/ -v --cov=src

    - name: æ£€æŸ¥PRæž„å»ºé…ç½®
      run: |
        echo "ðŸ“‹ æ£€æŸ¥PRæž„å»ºä¿¡æ¯..."
        echo "PRç¼–å·: ${{ github.event.number }}"
        echo "æºåˆ†æ”¯: ${{ github.head_ref }}"
        echo "ç›®æ ‡åˆ†æ”¯: ${{ github.base_ref }}"
        echo "å½“å‰æäº¤: ${{ github.sha }}"
        echo "åŒ…å«ARM64: ${{ github.event.inputs.include_arm64 || 'false' }}"

        # æ£€æŸ¥å›¾æ ‡æ–‡ä»¶
        echo "ðŸŽ¨ æ£€æŸ¥åº”ç”¨å›¾æ ‡æ–‡ä»¶..."
        ls -la src/resources/icons/

        # éªŒè¯æž„å»ºè„šæœ¬
        echo "ðŸ”§ éªŒè¯æž„å»ºè„šæœ¬..."
        python scripts/build.py --test-only

  # æž„å»ºå‘å¸ƒç‰ˆæœ¬ - æ”¯æŒå¤šå¹³å°å¤šæž¶æž„
  build-release:
    name: æž„å»ºå‘å¸ƒç‰ˆæœ¬
    needs: pre-release-check
    strategy:
      fail-fast: false
      matrix:
        include:
          # Windows x86_64 (ä¸»è¦æ”¯æŒ)
          - os: windows-latest
            platform: windows
            arch: x86_64
            runner_arch: X64

          # Linux x86_64 (ä¸»è¦æ”¯æŒ)
          - os: ubuntu-22.04  # æ˜Žç¡®æŒ‡å®šUbuntu 22.04
            platform: linux
            arch: x86_64
            runner_arch: X64

          # Linux ARM64 (æ–°å¢žæ”¯æŒ - 2025å¹´1æœˆ16æ—¥å·²å‘å¸ƒ)
          - os: ubuntu-24.04-arm
            platform: linux
            arch: arm64
            runner_arch: ARM64
            experimental: false

          # Windows ARM64 (2025å¹´1æœˆå¯ç”¨æµ‹è¯•)
          - os: windows-latest
            platform: windows
            arch: arm64
            runner_arch: ARM64
            experimental: true

    runs-on: ${{ matrix.os }}

    steps:
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v4

    - name: è®¾ç½®PythonçŽ¯å¢ƒ (Windows/macOS)
      if: matrix.platform != 'linux'
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
        architecture: ${{ matrix.runner_arch }}

    - name: è®¾ç½®PythonçŽ¯å¢ƒ (Linux - ç³»ç»ŸåŒ…ç®¡ç†å™¨)
      if: matrix.platform == 'linux'
      run: |
        echo "ðŸ ä½¿ç”¨ç³»ç»ŸåŒ…ç®¡ç†å™¨å®‰è£…Python 3.11 (Linuxå¹³å°)..."

        # å…³é”®ä¿®å¤ï¼šç¦ç”¨command-not-foundçš„APT hookï¼Œè§£å†³cnf-update-dbè„šæœ¬é—®é¢˜
        echo "ðŸ”§ ç¦ç”¨command-not-foundçš„APT hookï¼Œè§£å†³cnf-update-dbè„šæœ¬é—®é¢˜..."
        sudo mv /etc/apt/apt.conf.d/50command-not-found /etc/apt/apt.conf.d/50command-not-found.disabled 2>/dev/null || echo "âš ï¸ command-not-foundé…ç½®æ–‡ä»¶ä¸å­˜åœ¨ï¼Œè·³è¿‡"

        # çŽ°åœ¨å¯ä»¥æ­£å¸¸ä½¿ç”¨apt-get update
        echo "ðŸ“¦ æ›´æ–°åŒ…ç¼“å­˜..."
        sudo apt-get update

        sudo apt-get install -y software-properties-common
        sudo add-apt-repository ppa:deadsnakes/ppa -y
        sudo apt-get update

        # å®‰è£…Python 3.11å’Œç›¸å…³åŒ…
        sudo apt-get install -y python3.11 python3.11-venv python3.11-dev python3.11-distutils

        # å®‰è£…pip (deadsnakes PPAä¸­æ²¡æœ‰python3.11-pipï¼Œéœ€è¦æ‰‹åŠ¨å®‰è£…)
        curl -sS https://bootstrap.pypa.io/get-pip.py | python3.11

        # è®¾ç½®python3.11ä¸ºé»˜è®¤python3
        sudo update-alternatives --install /usr/bin/python3 python3 /usr/bin/python3.11 1

        # éªŒè¯å®‰è£…
        echo "âœ… Pythonå®‰è£…å®Œæˆï¼Œç‰ˆæœ¬ä¿¡æ¯ï¼š"
        python3 --version
        python3 -m pip --version



    - name: å®‰è£…ç³»ç»Ÿä¾èµ– (Linux)
      if: matrix.platform == 'linux'
      run: |
        echo "ðŸ“¦ å®‰è£…ç³»ç»Ÿä¾èµ–åŒ…..."
        # command-not-found hookå·²ç¦ç”¨ï¼Œå¯ä»¥æ­£å¸¸ä½¿ç”¨apt-get update
        sudo apt-get update

        sudo apt-get install -y \
          libgl1-mesa-glx \
          libglib2.0-0 \
          libxkbcommon-x11-0 \
          libxcb-icccm4 \
          libxcb-image0 \
          libxcb-keysyms1 \
          libxcb-randr0 \
          libxcb-render-util0 \
          libxcb-xinerama0 \
          libxcb-xfixes0

    - name: å®‰è£…Pythonä¾èµ–
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install pyinstaller

    - name: é…ç½®æž„å»ºçŽ¯å¢ƒ
      run: |
        echo "ðŸ”§ é…ç½® ${{ matrix.platform }}-${{ matrix.arch }} æž„å»ºçŽ¯å¢ƒ..."
        echo "å¹³å°: ${{ matrix.platform }}"
        echo "æž¶æž„: ${{ matrix.arch }}"
        echo "è¿è¡Œå™¨æž¶æž„: ${{ matrix.runner_arch }}"

        # è®¾ç½®çŽ¯å¢ƒå˜é‡
        echo "BUILD_PLATFORM=${{ matrix.platform }}" >> $GITHUB_ENV
        echo "BUILD_ARCH=${{ matrix.arch }}" >> $GITHUB_ENV

    - name: æž„å»ºå¯æ‰§è¡Œæ–‡ä»¶
      run: |
        echo "ðŸ”¨ æž„å»º ${{ matrix.platform }}-${{ matrix.arch }} ç‰ˆæœ¬..."

        # ä½¿ç”¨æ–°çš„æž„å»ºè„šæœ¬ï¼Œä¼ é€’å¹³å°å’Œæž¶æž„å‚æ•°
        python scripts/build.py --platform ${{ matrix.platform }} --arch ${{ matrix.arch }}
      shell: bash

    - name: éªŒè¯æž„å»ºç»“æžœ
      run: |
        echo "âœ… éªŒè¯ ${{ matrix.platform }}-${{ matrix.arch }} æž„å»ºç»“æžœ..."

        # æ£€æŸ¥æž„å»ºäº§ç‰© - é€‚é…æ–°çš„æž„å»ºè„šæœ¬è¾“å‡ºç»“æž„ï¼ˆåŒ…å«æž¶æž„ï¼‰
        DIST_DIR="dist/${{ matrix.platform }}-${{ matrix.arch }}"

        if [[ "${{ matrix.platform }}" == "windows" ]]; then
          # Windows: å•æ–‡ä»¶æ¨¡å¼
          EXECUTABLE="$DIST_DIR/EmailDomainManager.exe"
        else
          # Linux: ç›®å½•æ¨¡å¼
          EXECUTABLE="$DIST_DIR/EmailDomainManager/EmailDomainManager"
        fi

        if [[ -f "$EXECUTABLE" ]]; then
          echo "âœ… å¯æ‰§è¡Œæ–‡ä»¶æž„å»ºæˆåŠŸ: $EXECUTABLE"
          ls -la "$EXECUTABLE"

          # æ£€æŸ¥æ–‡ä»¶å¤§å°
          SIZE=$(stat -c%s "$EXECUTABLE" 2>/dev/null || stat -f%z "$EXECUTABLE" 2>/dev/null || echo "0")
          SIZE_MB=$((SIZE / 1024 / 1024))
          echo "ðŸ“¦ æ–‡ä»¶å¤§å°: ${SIZE_MB}MB"

          if [[ $SIZE_MB -lt 5 ]]; then
            echo "âš ï¸  è­¦å‘Š: æ–‡ä»¶å¤§å°å¼‚å¸¸å°ï¼Œå¯èƒ½æž„å»ºä¸å®Œæ•´"
          fi
        else
          echo "âŒ å¯æ‰§è¡Œæ–‡ä»¶æœªæ‰¾åˆ°: $EXECUTABLE"
          echo "ðŸ“ distç›®å½•å†…å®¹:"
          find dist/ -type f -ls 2>/dev/null || ls -la dist/ 2>/dev/null || echo "distç›®å½•ä¸å­˜åœ¨"
          exit 1
        fi
      shell: bash

    - name: åˆ›å»ºå‘å¸ƒåŒ…
      run: |
        echo "ðŸ“¦ åˆ›å»º ${{ matrix.platform }}-${{ matrix.arch }} å‘å¸ƒåŒ…..."

        # åˆ›å»ºå‘å¸ƒç›®å½•
        RELEASE_DIR="release-${{ matrix.platform }}-${{ matrix.arch }}"
        mkdir -p "$RELEASE_DIR"

        # å¤åˆ¶å¯æ‰§è¡Œæ–‡ä»¶å’Œç›¸å…³æ–‡ä»¶ï¼ˆé€‚é…æž¶æž„ï¼‰
        DIST_DIR="dist/${{ matrix.platform }}-${{ matrix.arch }}"

        if [[ "${{ matrix.platform }}" == "windows" ]]; then
          # Windows: ç›´æŽ¥ä½¿ç”¨exeæ–‡ä»¶ï¼Œä¸æ‰“åŒ…
          ARCHIVE_NAME="EmailDomainManager-${{ matrix.platform }}-${{ matrix.arch }}.exe"
          cp "$DIST_DIR/EmailDomainManager.exe" "$ARCHIVE_NAME"

          echo "âœ… Windowså¯æ‰§è¡Œæ–‡ä»¶å‡†å¤‡å®Œæˆ: $ARCHIVE_NAME"
          echo "ðŸ“ Windowsç‰ˆæœ¬è¯´æ˜Ž:"
          echo "  - åŒå‡»å³å¯è¿è¡Œï¼Œæ— éœ€å®‰è£…"
          echo "  - ç³»ç»Ÿè¦æ±‚: Windows 10+ (${{ matrix.arch }})"
          echo "  - é¦–æ¬¡è¿è¡Œå¯èƒ½éœ€è¦ç¡®è®¤å®‰å…¨è­¦å‘Š"
        else
          # Linux: ç›®å½•æ¨¡å¼ï¼Œå¤åˆ¶æ•´ä¸ªç›®å½•
          cp -r "$DIST_DIR/EmailDomainManager"/* "$RELEASE_DIR/"

          # åˆ›å»ºREADMEæ–‡ä»¶
          cat > "$RELEASE_DIR/README.txt" << EOF
åŸŸåé‚®ç®±ç®¡ç†å™¨ Linuxç‰ˆæœ¬

å®‰è£…è¯´æ˜Ž:
1. è§£åŽ‹æ–‡ä»¶: tar -xzf EmailDomainManager-linux-${{ matrix.arch }}.tar.gz
2. è¿›å…¥ç›®å½•: cd EmailDomainManager-linux-${{ matrix.arch }}
3. æ·»åŠ æ‰§è¡Œæƒé™: chmod +x EmailDomainManager
4. è¿è¡Œç¨‹åº: ./EmailDomainManager

ç³»ç»Ÿè¦æ±‚:
- Linuxå‘è¡Œç‰ˆ (Ubuntu 18.04+ç­‰) (${{ matrix.arch }})
- 4GB RAM (æŽ¨è)
- 100MB ç£ç›˜ç©ºé—´
- X11æˆ–Waylandæ˜¾ç¤ºæœåŠ¡å™¨

æ³¨æ„äº‹é¡¹:
- ç¡®ä¿ç³»ç»Ÿå·²å®‰è£…Qt6è¿è¡Œæ—¶åº“
- å¦‚é‡åˆ°ä¾èµ–é—®é¢˜ï¼Œè¯·å®‰è£…: sudo apt install qt6-base-dev
EOF

          ARCHIVE_NAME="EmailDomainManager-${{ matrix.platform }}-${{ matrix.arch }}.tar.gz"

          # Linuxå¹³å°ä½¿ç”¨tar.gzæ‰“åŒ…
          tar -czf "$ARCHIVE_NAME" -C "$RELEASE_DIR" .
        fi

        echo "âœ… å‘å¸ƒåŒ…åˆ›å»ºå®Œæˆ: $ARCHIVE_NAME"
        ls -la "$ARCHIVE_NAME"

        # è®¾ç½®è¾“å‡ºå˜é‡
        echo "ARCHIVE_NAME=$ARCHIVE_NAME" >> $GITHUB_ENV
        echo "RELEASE_DIR=$RELEASE_DIR" >> $GITHUB_ENV
      shell: bash

    - name: ä¸Šä¼ æž„å»ºäº§ç‰©
      uses: actions/upload-artifact@v4
      with:
        name: build-${{ matrix.platform }}-${{ matrix.arch }}
        path: |
          ${{ env.ARCHIVE_NAME }}
          ${{ env.RELEASE_DIR }}/
        retention-days: 30

  # åˆ›å»ºGitHub Release (ä¸´æ—¶å…è®¸PRè§¦å‘ï¼Œç”¨äºŽæµ‹è¯•)
  create-release:
    name: åˆ›å»ºGitHub Release
    needs: build-release
    runs-on: ubuntu-22.04  # æ˜Žç¡®æŒ‡å®šUbuntu 22.04
    if: github.event_name == 'push' || github.event_name == 'workflow_dispatch' || github.event_name == 'pull_request'

    steps:
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v4

    - name: ä¸‹è½½æ‰€æœ‰æž„å»ºäº§ç‰©
      uses: actions/download-artifact@v4
      with:
        path: artifacts/

    - name: æ•´ç†æž„å»ºäº§ç‰©
      run: |
        echo "ðŸ“ æ•´ç†æž„å»ºäº§ç‰©..."
        find artifacts/ -name "*.exe" -o -name "*.tar.gz" | while read file; do
          echo "å‘çŽ°æž„å»ºäº§ç‰©: $file"
          cp "$file" ./
        done

        echo "ðŸ“¦ æœ€ç»ˆå‘å¸ƒæ–‡ä»¶:"
        ls -la *.exe *.tar.gz 2>/dev/null || echo "æ²¡æœ‰æ‰¾åˆ°å‘å¸ƒæ–‡ä»¶"

    - name: ç”Ÿæˆå‘å¸ƒè¯´æ˜Ž
      run: |
        echo "ðŸ“ ç”Ÿæˆå‘å¸ƒè¯´æ˜Ž..."

        # èŽ·å–æœ€æ–°çš„æäº¤ä¿¡æ¯ä½œä¸ºå‘å¸ƒè¯´æ˜Ž
        RELEASE_NOTES=$(git log --pretty=format:"- %s" -10)

        # æ ¹æ®äº‹ä»¶ç±»åž‹è®¾ç½®å‘å¸ƒç±»åž‹æ ‡è¯†
        if [[ "${{ github.event_name }}" == "pull_request" ]]; then
          RELEASE_TYPE="ðŸ§ª æµ‹è¯•ç‰ˆæœ¬ (PR #${{ github.event.number }})"
          RELEASE_TITLE="åŸŸåé‚®ç®±ç®¡ç†å™¨ æµ‹è¯•ç‰ˆæœ¬"
        else
          RELEASE_TYPE="ðŸŽ‰ æ­£å¼å‘å¸ƒç‰ˆæœ¬"
          RELEASE_TITLE="åŸŸåé‚®ç®±ç®¡ç†å™¨ å¤šå¹³å°å‘å¸ƒç‰ˆæœ¬"
        fi

        cat > release-notes.md << EOF
        # $RELEASE_TITLE

        ## $RELEASE_TYPE

        ## ðŸŽ‰ æ–°åŠŸèƒ½å’Œæ”¹è¿›

        $RELEASE_NOTES

        ## ðŸ“¦ ä¸‹è½½è¯´æ˜Ž

        ### æ”¯æŒçš„å¹³å°å’Œæž¶æž„

        - **Windows x86_64**: ä¸‹è½½ \`EmailDomainManager-windows-x86_64.exe\`
        - **Windows ARM64**: ä¸‹è½½ \`EmailDomainManager-windows-arm64.exe\` (å®žéªŒæ€§æ”¯æŒ)
        - **Linux x86_64**: ä¸‹è½½ \`EmailDomainManager-linux-x86_64.tar.gz\`
        - **Linux ARM64**: ä¸‹è½½ \`EmailDomainManager-linux-arm64.tar.gz\`

        ## ðŸš€ å®‰è£…è¯´æ˜Ž

        ### Windowsç”¨æˆ·
        1. **x86_64è®¾å¤‡**: ä¸‹è½½ \`EmailDomainManager-windows-x86_64.exe\`
        2. **ARM64è®¾å¤‡**: ä¸‹è½½ \`EmailDomainManager-windows-arm64.exe\` (Surface Pro Xç­‰ARMè®¾å¤‡)
        3. åŒå‡»exeæ–‡ä»¶ç›´æŽ¥è¿è¡Œï¼Œæ— éœ€å®‰è£…

        ### Linuxç”¨æˆ·
        1. **x86_64è®¾å¤‡**: ä¸‹è½½ \`EmailDomainManager-linux-x86_64.tar.gz\`
        2. **ARM64è®¾å¤‡**: ä¸‹è½½ \`EmailDomainManager-linux-arm64.tar.gz\` (æ ‘èŽ“æ´¾ã€ARMæœåŠ¡å™¨ç­‰)
        3. è§£åŽ‹: \`tar -xzf EmailDomainManager-linux-æž¶æž„.tar.gz\`
        4. æ·»åŠ æ‰§è¡Œæƒé™: \`chmod +x EmailDomainManager\`
        5. è¿è¡Œ: \`./EmailDomainManager\`

        ## ðŸ“‹ ç³»ç»Ÿè¦æ±‚

        - **Windows**: Windows 10+ (x86_64/ARM64)
        - **Linux**: çŽ°ä»£Linuxå‘è¡Œç‰ˆ (x86_64/ARM64)ï¼Œæ”¯æŒX11æˆ–Wayland
        - **å†…å­˜**: 4GB+ RAM (æŽ¨è)
        - **å­˜å‚¨**: 100MB+ ç£ç›˜ç©ºé—´

        ## ðŸŽ¨ åº”ç”¨ç‰¹æ€§

        - åŸºäºŽPyQt6çš„çŽ°ä»£åŒ–ç•Œé¢
        - Material Designè®¾è®¡é£Žæ ¼
        - æ”¯æŒWindows (.ico) å’Œ Linux (.png) å¹³å°å›¾æ ‡
        - å®Œæ•´çš„é‚®ç®±ç®¡ç†åŠŸèƒ½

        ## ðŸ› é—®é¢˜åé¦ˆ

        å¦‚æœ‰é—®é¢˜è¯·åœ¨ [Issues](https://github.com/your-username/email-domain-manager/issues) ä¸­åé¦ˆã€‚
        EOF

    - name: ç¡®å®šç‰ˆæœ¬å·
      id: version
      run: |
        if [[ "${{ github.event_name }}" == "workflow_dispatch" ]]; then
          VERSION="${{ github.event.inputs.version }}"
        elif [[ "${{ github.event_name }}" == "pull_request" ]]; then
          # PRæµ‹è¯•ç‰ˆæœ¬ï¼šåŒ…å«PRç¼–å·
          VERSION="v$(date +'%Y.%m.%d')-pr${{ github.event.number }}-test${{ github.run_number }}"
        else
          # è‡ªåŠ¨ç”Ÿæˆç‰ˆæœ¬å·ï¼švå¹´.æœˆ.æ—¥-æž„å»ºå·
          VERSION="v$(date +'%Y.%m.%d')-${{ github.run_number }}"
        fi
        echo "version=$VERSION" >> $GITHUB_OUTPUT
        echo "å‘å¸ƒç‰ˆæœ¬: $VERSION"

    - name: åˆ›å»ºRelease
      uses: softprops/action-gh-release@v1
      with:
        tag_name: ${{ steps.version.outputs.version }}
        name: åŸŸåé‚®ç®±ç®¡ç†å™¨ ${{ steps.version.outputs.version }}
        body_path: release-notes.md
        draft: false
        prerelease: ${{ github.event_name == 'pull_request' }}
        files: |
          EmailDomainManager-windows-x86_64.exe
          EmailDomainManager-windows-arm64.exe
          EmailDomainManager-linux-x86_64.tar.gz
          EmailDomainManager-linux-arm64.tar.gz
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

  # éƒ¨ç½²æ–‡æ¡£ (ä¸´æ—¶å…è®¸PRè§¦å‘ï¼Œç”¨äºŽæµ‹è¯•)
  deploy-docs:
    name: éƒ¨ç½²æ–‡æ¡£
    needs: create-release
    runs-on: ubuntu-22.04  # æ˜Žç¡®æŒ‡å®šUbuntu 22.04
    if: github.event_name == 'push' || github.event_name == 'workflow_dispatch' || github.event_name == 'pull_request'

    steps:
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v4

    - name: è®¾ç½®PythonçŽ¯å¢ƒ
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'

    - name: å®‰è£…æ–‡æ¡£å·¥å…·
      run: |
        python -m pip install --upgrade pip
        pip install mkdocs mkdocs-material

    - name: æž„å»ºæ–‡æ¡£
      run: |
        echo "ðŸ“š æž„å»ºé¡¹ç›®æ–‡æ¡£..."

        # åˆ›å»ºmkdocsé…ç½®
        cat > mkdocs.yml << EOF
        site_name: åŸŸåé‚®ç®±ç®¡ç†å™¨
        site_description: åŸºäºŽPyQt6çš„åŸŸåé‚®ç®±ç®¡ç†å·¥å…· - å¤šå¹³å°è‡ªåŠ¨æ‰“åŒ…å‘å¸ƒ

        nav:
          - é¦–é¡µ: README.md
          - ä¸‹è½½å®‰è£…: docs/installation.md
          - ä½¿ç”¨æŒ‡å—: docs/user-guide.md
          - å¼€å‘æ–‡æ¡£: docs/development.md
          - APIè§„èŒƒ: docs/api-specification.md
          - æ›´æ–°æ—¥å¿—: docs/changelog.md

        theme:
          name: material
          language: zh
          palette:
            - scheme: default
              primary: blue
              accent: blue
              toggle:
                icon: material/brightness-7
                name: åˆ‡æ¢åˆ°æ·±è‰²æ¨¡å¼
            - scheme: slate
              primary: blue
              accent: blue
              toggle:
                icon: material/brightness-4
                name: åˆ‡æ¢åˆ°æµ…è‰²æ¨¡å¼
          features:
            - navigation.tabs
            - navigation.sections
            - navigation.expand
            - navigation.top
            - search.highlight
            - search.share
            - content.code.copy

        markdown_extensions:
          - pymdownx.highlight
          - pymdownx.superfences
          - pymdownx.tabbed
          - admonition
          - pymdownx.details
        EOF

        # åˆ›å»ºåŸºç¡€æ–‡æ¡£ç»“æž„
        mkdir -p docs

        # åˆ›å»ºå®‰è£…æ–‡æ¡£
        cat > docs/installation.md << EOF
        # ä¸‹è½½ä¸Žå®‰è£…

        ## æ”¯æŒçš„å¹³å°

        - Windows x86_64
        - Linux x86_64

        ## ä¸‹è½½åœ°å€

        è¯·è®¿é—® [GitHub Releases](https://github.com/your-username/email-domain-manager/releases) ä¸‹è½½æœ€æ–°ç‰ˆæœ¬ã€‚

        ## å®‰è£…è¯´æ˜Ž

        ### Windows
        1. ä¸‹è½½ \`EmailDomainManager-windows-x86_64.zip\`
        2. è§£åŽ‹åˆ°ä»»æ„ç›®å½•
        3. åŒå‡» \`EmailDomainManager.exe\` è¿è¡Œ

        ### Linux
        1. ä¸‹è½½ \`EmailDomainManager-linux-x86_64.tar.gz\`
        2. è§£åŽ‹å¹¶è¿è¡Œ
        EOF

        mkdocs build

    - name: éƒ¨ç½²åˆ°GitHub Pages
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./site

  # æž„å»ºé€šçŸ¥å’Œæ€»ç»“
  build-notification:
    name: æž„å»ºé€šçŸ¥
    needs: [build-release, create-release, deploy-docs]
    runs-on: ubuntu-22.04  # æ˜Žç¡®æŒ‡å®šUbuntu 22.04
    if: always()

    steps:
    - name: æž„å»ºç»“æžœé€šçŸ¥
      run: |
        if [[ "${{ github.event_name }}" == "pull_request" ]]; then
          echo "ðŸ” PRæž„å»ºæµ‹è¯•å’Œé¢„å‘å¸ƒå®Œæˆ"
          echo "========================"
          echo "PRä¿¡æ¯:"
          echo "  - PRç¼–å·: #${{ github.event.number }}"
          echo "  - æºåˆ†æ”¯: ${{ github.head_ref }}"
          echo "  - ç›®æ ‡åˆ†æ”¯: ${{ github.base_ref }}"
          echo "  - æµ‹è¯•ç‰ˆæœ¬: ${{ needs.create-release.outputs.version || 'æœªçŸ¥' }}"
        else
          echo "ðŸŽ‰ æ­£å¼å‘å¸ƒæµç¨‹å®Œæˆ"
          echo "========================"
        fi

        # æ£€æŸ¥æž„å»ºä»»åŠ¡ç»“æžœ
        echo "ðŸ“‹ ä»»åŠ¡æ‰§è¡Œç»“æžœ:"
        echo "  - æž„å»ºæµ‹è¯•: ${{ needs.build-release.result }}"

        if [[ "${{ github.event_name }}" == "push" ]] || [[ "${{ github.event_name }}" == "workflow_dispatch" ]]; then
          echo "  - åˆ›å»ºRelease: ${{ needs.create-release.result }}"
          echo "  - éƒ¨ç½²æ–‡æ¡£: ${{ needs.deploy-docs.result }}"
        fi

        if [[ "${{ contains(needs.*.result, 'failure') }}" == "true" ]]; then
          echo ""
          echo "âŒ æµç¨‹ä¸­å‡ºçŽ°é—®é¢˜"
          echo "å¤±è´¥çš„ä»»åŠ¡:"
          [[ "${{ needs.build-release.result }}" == "failure" ]] && echo "  - æž„å»ºæµ‹è¯•å¤±è´¥"
          [[ "${{ needs.create-release.result }}" == "failure" ]] && echo "  - åˆ›å»ºReleaseå¤±è´¥"
          [[ "${{ needs.deploy-docs.result }}" == "failure" ]] && echo "  - éƒ¨ç½²æ–‡æ¡£å¤±è´¥"
          echo ""
          echo "è¯·æ£€æŸ¥ä¸Šè¿°å¤±è´¥ä»»åŠ¡çš„æ—¥å¿—ä»¥èŽ·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯ã€‚"
        else
          echo ""
          if [[ "${{ github.event_name }}" == "pull_request" ]]; then
            echo "âœ… PRæž„å»ºæµ‹è¯•å’Œé¢„å‘å¸ƒæˆåŠŸï¼"
            echo "ðŸ“¦ æ‰€æœ‰4ä¸ªå¹³å°æž„å»ºæˆåŠŸ"
            echo "ðŸŽ¯ å·²åˆ›å»ºæµ‹è¯•ç‰ˆæœ¬Releaseï¼Œå¯ä»¥ä¸‹è½½æµ‹è¯•"
            echo "âœ… æµ‹è¯•é€šè¿‡åŽå¯ä»¥å®‰å…¨åˆå¹¶åˆ°mainåˆ†æ”¯"
          else
            echo "ðŸŽ‰ æ­£å¼å‘å¸ƒæˆåŠŸå®Œæˆï¼"
            echo "ðŸ“¦ æ–°ç‰ˆæœ¬å·²å‘å¸ƒåˆ°GitHub Releases"
            echo "ðŸ“š æ–‡æ¡£å·²æ›´æ–°åˆ°GitHub Pages"
            echo ""
            echo "ðŸ”— ç›¸å…³é“¾æŽ¥:"
            echo "  - Releases: https://github.com/${{ github.repository }}/releases"
            echo "  - æ–‡æ¡£: https://${{ github.repository_owner }}.github.io/${{ github.event.repository.name }}"
          fi
        fi

        echo ""
        echo "ðŸ“Š æž„å»ºç»Ÿè®¡:"
        echo "  - æ”¯æŒå¹³å°: Windows x86_64/ARM64, Linux x86_64/ARM64"
        echo "  - æž„å»ºæ—¶é—´: $(date)"
        echo "  - PRç¼–å·: #${{ github.event.number }}"
        echo "  - æºåˆ†æ”¯: ${{ github.head_ref }}"
        echo "  - æäº¤SHA: ${{ github.sha }}"
